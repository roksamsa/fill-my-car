<app-content>
  <div class="trip">
    <app-tile class="tile tile--title-top tile--trip tile--trip-details">
      <div class="trip__headline">
        <div class="trip__headline-left">
          <div *ngIf="authService.isLoggedIn" class="trip__go-back" (click)="goBack()" matTooltip="Vrni se nazaj" matTooltipPosition="left">
            <svg class="trip__go-back-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
              <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" /></svg>
          </div>
          <div class="trip__id-tag">Potovanje <span class="trip__id-tag-string">#{{ trip?.tripIdTag }}</span></div>
          <div class="trip__status" matTooltip="{{statusIconTooltip}}" matTooltipPosition="right" [ngClass]="{'trip__status--active': isTripActive}">
            <div class="trip__status-icon"></div>
          </div>
        </div>
        <div class="trip__actions">
          <div class="trip__actions-item trip__actions-item--share" matTooltip="Deli potovanje" matTooltipPosition="left">
            <svg class="trip__actions-item-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
              viewBox="0 0 24 24">
              <path
                d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z" />
            </svg>
          </div>
          <div *ngIf="authService.isLoggedIn"
               class="trip__actions-item trip__actions-item--edit"
               matTooltip="Uredi potovanje"
               matTooltipPosition="right"
               (click)="openEditVehicleDialog(trip, tripIndex)">
            <svg class="trip__actions-item-svg" class="trip__svg-icon" xmlns="http://www.w3.org/2000/svg" width="24"
              height="24" viewBox="0 0 24 24">
              <path
                d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
            </svg>
          </div>
        </div>
      </div>
      <div class="trip__main-details">
        <app-preloading-spinner [visibility]="preloadingSpinnerVisibility">
          <div class="trip__destinations">
            <div class="trip__location trip__location--start">
              {{ tripFromLocationCity }}
            </div>
            <div class="trip__location-dots"></div>
            <div class="trip__location trip__location--end">
              {{ tripToLocationCity }}
            </div>
          </div>
          <div class="trip__date-time">
            <div class="trip__date" matTooltip="Datum odhoda" matTooltipPosition="above">
              <div class="trip__date-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path d="M0 0h24v24H0z" fill="none" />
                  <path
                    d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z" />
                </svg>
              </div>
              <div class="trip__date-text">
                {{ trip?.tripDate | date: dateFormat}}
              </div>
            </div>
            <div class="trip__time" matTooltip="Čas odhoda" matTooltipPosition="above">
              <div class="trip__time-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path
                    d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z" />
                  <path d="M0 0h24v24H0z" fill="none" />
                  <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z" /></svg>
              </div>
              <div class="trip__time-text">
                {{ trip?.tripTime }}
              </div>
            </div>
          </div>
          <div class="trip__graphics">
            <div class="trip__vehicle">
              <app-vehicle-tile class="vehicle-tile--single vehicle-tile--single-trip-details"
                                [vehicleType]="selectedTypeData"
                                [vehicleColor]="selectedColorData"
                                [vehicleBrand]="selectedBrandData"
                                [vehicleName]="selectedNameData"
                                [vehicleTextVisible]="true"></app-vehicle-tile>
            </div>
            <div *ngIf="vehicleSeatsAvailableNumber" class="trip__vehicle-seats">
              <app-vehicle-seats></app-vehicle-seats>
            </div>
          </div>
        </app-preloading-spinner>
      </div>

      <div class="trip__bottom-details">
        <div class="trip__bottom-divider"></div>

        <form [formGroup]="addTripFormStepperForm" class="form" [ngClass]="{'form--without-button': vehicleSeatsAvailableNumber == vehicleSeatsTakenNumber}">
          <mat-horizontal-stepper class="trip-add-passengers__wizard" [ngClass]="{'trip-add-passengers__wizard--last-step': stepper.selectedIndex === 5}" [linear]="true" formArrayName="addTripFormStepperFormArray" #stepper>

            <!-- STEP 0 -->
            <mat-step id="tripInputStep0" class="trip__price-container">
              <div class="trip__price-label">
                Cena prevoza na osebo
              </div>
              <app-preloading-spinner class="trip__price preloading-spinner--width-height-as-content" [visibility]="preloadingSpinnerVisibility">
                {{ trip?.tripPrice }} EUR
              </app-preloading-spinner>
            </mat-step>

            <!-- STEP 1 -->
            <mat-step id="tripInputStep1"
                      class="trip__price-container"
                      formGroupName="1"
                      [stepControl]="addTripFormStepperFormArray?.get([1])">
              <div class="form__input form__input--join-trip">
                <label class="form__label">Koliko mest želite rezervirati? (največ {{vehicleSeatsStillLeftForCurrentTrip}})</label>
                <div class="form__seats-reservation-wrapper">
                  <app-number-picker class="form__time-input"
                                     [min]="1"
                                     [step]="1"
                                     [max]="vehicleSeatsStillLeftForCurrentTrip"
                                     [precision]="1"
                                     [inputDisabled]="false"
                                     (change)="seatsInputChange($event)">
                  </app-number-picker>
                </div>
              </div>
            </mat-step>

            <!-- STEP 2 -->
            <mat-step id="tripInputStep2"
                      class="trip__price-container"
                      formGroupName="2"
                      [stepControl]="addTripFormStepperFormArray?.get([2])">
              <div class="form__input form__input--join-trip">
                <label class="form__label">Kje želite, da vas voznik pobere?</label>
                <mat-form-field [floatLabel]="'never'" class="form__field">
                  <input matInput placeholder="Lokacija odhoda" formControlName="yourStartLocation" #yourStartLocation>
                </mat-form-field>
              </div>
            </mat-step>

            <!-- STEP 3 -->
            <mat-step id="tripInputStep3"
                      class="trip__price-container"
                      formGroupName="3"
                      [stepControl]="addTripFormStepperFormArray?.get([3])">
              <div class="form__input form__input--join-trip">
                <label class="form__label">Kje želite, da vas voznik odloži?</label>
                <mat-form-field [floatLabel]="'never'" class="form__field">
                  <input matInput placeholder="Lokacija prihoda" formControlName="yourEndLocation" #yourEndLocation>
                </mat-form-field>
              </div>
            </mat-step>

            <!-- STEP 4 -->
            <mat-step id="tripInputStep4"
                      class="trip__price-container"
                      formGroupName="4"
                      [stepControl]="addTripFormStepperFormArray?.get([4])">
              <div class="form__input form__input--join-this-trip">
                <label *ngIf="!socialUser" class="form__label">Prijavite se na prevoz z:</label>

                <div *ngIf="!socialUser" class="join-this-trip__options">
                  <svg (click)="signInWithFacebook()" class="join-this-trip__options-icon join-this-trip__options-icon--facebook"
                    enable-background="new 0 0 56.693 56.693" height="56.693px" id="Layer_1" version="1.1"
                    viewBox="0 0 56.693 56.693" width="56.693px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink">
                    <path
                      d="M28.347,5.157c-13.6,0-24.625,11.027-24.625,24.625c0,13.6,11.025,24.623,24.625,24.623c13.6,0,24.625-11.023,24.625-24.623  C52.972,16.184,41.946,5.157,28.347,5.157z M34.864,29.679h-4.264c0,6.814,0,15.207,0,15.207h-6.32c0,0,0-8.307,0-15.207h-3.006  V24.31h3.006v-3.479c0-2.49,1.182-6.377,6.379-6.377l4.68,0.018v5.215c0,0-2.846,0-3.398,0c-0.555,0-1.34,0.277-1.34,1.461v3.163  h4.818L34.864,29.679z" />
                  </svg>
                  <svg (click)="signInWithGoogle()" class="join-this-trip__options-icon join-this-trip__options-icon--google" height="56.6934px"
                    id="Layer_1" style="enable-background:new 0 0 56.6934 56.6934;" version="1.1"
                    viewBox="0 0 56.6934 56.6934" width="56.6934px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink">
                    <path
                      d="M28.4597,4.0154c-13.6006,0-24.625,11.0273-24.625,24.625c0,13.5996,11.0244,24.623,24.625,24.623  c13.5996,0,24.625-11.0234,24.625-24.623C53.0847,15.0426,42.0593,4.0154,28.4597,4.0154z M42.6077,33.8793  c-0.6971,2.4016-2.0137,4.6364-3.8595,6.3326c-1.7462,1.6122-3.9333,2.7168-6.2449,3.2488  c-2.5577,0.5821-5.2626,0.5976-7.8036-0.084c-2.0137-0.5356-3.9131-1.4954-5.5425-2.7948  c-1.7272-1.3727-3.1511-3.1237-4.1442-5.0933c-1.5282-3.0176-1.9982-6.5501-1.3239-9.8632  c0.2681-1.3298,0.7144-2.6226,1.3256-3.8339c1.7558-3.5151,4.9224-6.2962,8.6412-7.5694c3.3-1.1421,6.9968-1.1165,10.2748,0.09  c1.8207,0.6685,3.4871,1.726,4.9086,3.0414c-0.4755,0.5165-0.9914,0.9974-1.4823,1.5002c-0.936,0.9342-1.869,1.8719-2.8068,2.8043  c-0.9276-0.8859-2.0602-1.5591-3.2887-1.9321c-1.4454-0.4373-3.0021-0.4975-4.4785-0.1823  c-1.7242,0.3694-3.3245,1.2702-4.5554,2.5303c-0.9979,1.0104-1.7576,2.252-2.2139,3.5961c-0.6577,1.9071-0.653,4.0311-0.003,5.9399  c0.6357,1.8767,1.8737,3.5443,3.496,4.684c1.0146,0.7155,2.1776,1.2231,3.396,1.4662c1.1981,0.2425,2.4391,0.2163,3.6402,0.0114  c1.1934-0.2091,2.351-0.6488,3.3584-1.3262c1.6027-1.0706,2.7328-2.8097,3.054-4.7114c-2.7704-0.0012-5.5414-0.0006-8.3124,0  c-0.0035-1.9839-0.0005-3.9685-0.0012-5.953c4.7847-0.0006,9.5694-0.0018,14.3541,0.0005  C43.4728,28.4631,43.3679,31.2596,42.6077,33.8793z" />
                  </svg>
                  <svg class="join-this-trip__options-icon join-this-trip__options-icon--phone" version="1.1" id="Layer_1"
                    xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" fill="red"
                    viewBox="0 0 56.7 56.7" style="enable-background:new 0 0 56.7 56.7;" xml:space="preserve">
                    <path d="M28.1,3.6c-13.6,0-24.6,11-24.6,24.6c0,13.6,11,24.6,24.6,24.6c13.6,0,24.6-11,24.6-24.6C52.7,14.6,41.7,3.6,28.1,3.6z
        M41.9,38c-0.3,0.8-1.5,2.3-2.4,3c-0.8,0.6-1.3,0.8-2.1,0.8c-0.6,0-0.8,0-1.6-0.3c-6-2.5-10.8-6.2-14.6-11.2c-2-2.6-3.5-5.4-4.5-8.2
        c-0.6-1.7-0.6-2.4-0.1-3.2c0.2-0.4,1.1-1.2,1.8-1.7c1.1-0.8,1.6-1.1,2-1.2c0.3-0.1,0.8,0,1.1,0.1c0.1,0.1,0.4,0.2,0.5,0.3
        c0.8,0.5,3.1,3.4,3.8,4.9c0.4,0.8,0.6,1.4,0.4,1.9c-0.1,0.5-0.4,0.7-1.4,1.6c-0.4,0.3-0.8,0.7-0.8,0.8c-0.2,0.2-0.3,0.7-0.3,1
        c0,0.7,0.5,2,1.1,3c0.5,0.8,1.3,1.8,2.1,2.5c1,0.9,1.8,1.5,2.8,2c1.2,0.6,2,0.8,2.6,0.5c0.1-0.1,0.3-0.1,0.3-0.2
        c0,0,0.4-0.4,0.7-0.9c0.7-0.9,0.8-1,1.3-1.2c0.6-0.2,1.2-0.1,1.8,0.2c0.5,0.2,1.5,0.9,2.2,1.3c0.9,0.6,2.7,2.1,3,2.4
        C42.1,36.5,42.2,37.2,41.9,38z" />
                  </svg>
                </div>
                <div *ngIf="socialUser" class="join-this-trip__user-data">
                  <div class="join-this-trip__user-left">
                    <div class="join-this-trip__user-image">
                      <img class="join-this-trip__user-url-image" src="{{socialUser?.photoUrl}}"/>
                    </div>
                  </div>
                  <div class="join-this-trip__user-right">
                    <div class="join-this-trip__user-name">{{socialUser?.name}}</div>
                    <div class="join-this-trip__user-email">{{socialUser?.email}}</div>
                </div>
                </div>
              </div>
            </mat-step>

            <!-- STEP 5 -->
            <mat-step id="tripInputStep5"
                      class="trip__price-container"
                      formGroupName="5">
              <div class="form__input form__input--join-this-trip">
                <div class="end-of-registration">
                  <div class="end-of-registration__icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64.747" height="64.747" viewBox="0 0 64.747 64.747"><g transform="translate(-1 -1)"><path d="M33.374,65.747A32.374,32.374,0,1,1,65.747,33.374,32.374,32.374,0,0,1,33.374,65.747Zm0-60.431A28.057,28.057,0,1,0,61.431,33.374,28.057,28.057,0,0,0,33.374,5.316Z" transform="translate(0 0)" fill="#56ab00"/><path d="M20.183,35.957a2.158,2.158,0,0,1-1.576-.691L8.529,24.475A2.158,2.158,0,0,1,11.68,21.54l8.5,9.086L38.744,10.749a2.158,2.158,0,1,1,3.151,2.935L21.759,35.266A2.158,2.158,0,0,1,20.183,35.957Z" transform="translate(8.162 10.366)" fill="#56ab00"/></g></svg>
                  </div>
                  <label *ngIf="vehicleSeatsSelectedNumber === 1" class="end-of-registration__label">Rezervirali ste <b>eno mesto</b> na tem potovanju.</label>
                  <label *ngIf="vehicleSeatsSelectedNumber === 2" class="end-of-registration__label">Rezervirali ste <b>dve mesti</b> na tem potovanju.</label>
                  <label *ngIf="vehicleSeatsSelectedNumber === 3 || vehicleSeatsSelectedNumber === 4" class="end-of-registration__label">Rezervirali ste <b>{{vehicleSeatsSelectedNumber}} mesta</b> na tem potovanju.</label>
                  <label *ngIf="vehicleSeatsSelectedNumber > 4" class="end-of-registration__label">Rezervirali ste {{vehicleSeatsSelectedNumber}} mest na tem potovanju.</label>
                </div>
              </div>
            </mat-step>
          </mat-horizontal-stepper>
        </form>

        <div class="trip__button-wrapper">
          <button *ngIf="stepper.selectedIndex === 0 && vehicleSeatsAvailableNumber != vehicleSeatsTakenNumber" mat-raised-button class="button button--primary"
            (click)="joinTripStart()">Prijavi se na potovanje</button>

          <p *ngIf="vehicleSeatsAvailableNumber == vehicleSeatsTakenNumber">Na potovanje prijava ni več možna!</p>

          <button *ngIf="stepper.selectedIndex > 0 && stepper.selectedIndex < 5" class="button button--just-icon button--space-right" (click)="cancelTripBooking()" type="button">
            <svg class="popup__close-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
              viewBox="0 0 24 24">
              <path
                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
              <path d="M0 0h24v24H0z" fill="none" />
            </svg>
          </button>

          <button *ngIf="stepper.selectedIndex === 1" mat-raised-button class="button button--default" (click)="joinTrip1()" type="button">
            Izbira lokacije odhoda
            <svg class="button__icon button__icon--on-right" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
              viewBox="0 0 24 24">
              <path d="M0 0h24v24H0z" fill="none" />
              <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z" />
            </svg>
          </button>

          <button *ngIf="stepper.selectedIndex === 2" mat-raised-button class="button button--default" (click)="joinTrip2()" type="button">
            Izbira lokacije prihoda
            <svg class="button__icon button__icon--on-right" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
              viewBox="0 0 24 24">
              <path d="M0 0h24v24H0z" fill="none" />
              <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z" />
            </svg>
          </button>

          <button *ngIf="stepper.selectedIndex === 3" mat-raised-button class="button button--default" (click)="joinTrip3()" type="button">
            Potrdi rezervacijo
            <svg class="button__icon button__icon--on-right" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
              viewBox="0 0 24 24">
              <path d="M0 0h24v24H0z" fill="none" />
              <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z" />
            </svg>
          </button>

          <button *ngIf="stepper.selectedIndex === 4"
                  mat-raised-button
                  type="button"
                  class="button button--primary"
                  [disabled]="!socialUser"
                  (click)="joinTripSave(
                    trip?.tripPrice,
                    trip?.selectedVehicle,
                    trip?.tripIdTag,
                    vehicleSeatsSelectedNumber,
                    yourStartLocation?.value,
                    yourEndLocation?.value,
                    socialUser?.name,
                    socialUser?.email,
                    socialUser?.email)">
            Zaključi rezervacijo
          </button>
        </div>

      </div>
    </app-tile>
    <app-tile class="tile tile--trip tile--trip-map">
      <app-here-maps class="here-maps--trip-map" [hereMapStart]="hereMapStart" [hereMapFinish]="hereMapFinish">
      </app-here-maps>
    </app-tile>
  </div>
</app-content>
