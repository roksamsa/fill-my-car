<div class="popup__header">
  <h2 class="popup__headline">Dodajanje novega potovanja</h2>
  <div class="popup__close" (click)="onCloseCancel()">
    <svg class="popup__close-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
      <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
      <path d="M0 0h24v24H0z" fill="none" /></svg>
  </div>
</div>

<div class="popup__content">
  <mat-dialog-content>
    <mat-horizontal-stepper class="popup__wizard" [linear]="false" #stepper>

      <!-- STEP 1 -->
      <mat-step [stepControl]="addTripFormStep1">
        <ng-template matStepLabel>Potek vožnje</ng-template>
        <form [formGroup]="addTripFormStep1" class="form">

          <section class="form__row form__row--2-input-fields">
            <div class="form__input">
              <label class="form__label">Odhod iz</label>
              <mat-form-field class="form__field">
                <input (keyup)="valueChangeStartDestination($event)" matInput
                  placeholder="Ljubljana, Maribor, Koper, ..." formControlName="tripFromLocation" #tripFromLocation
                  [matAutocomplete]="matAutocompleteStart">
              </mat-form-field>
            </div>

            <mat-autocomplete #matAutocompleteStart="matAutocomplete"
              (optionSelected)="selectStartLocationSuggestion($event.option.value)">
              <mat-option *ngFor="let hereMapsLocation of locationStartSuggestions"
                [value]="hereMapsLocation.Location.Address.Label">{{hereMapsLocation.Location.Address.Label}}
              </mat-option>
            </mat-autocomplete>

            <div class="form__button form__button--just-icon form__button--space-left-right"
              (click)="swapStartFinishLocation()">
              <svg class="form__svg-icon form__svg-icon--change-arrows" xmlns="http://www.w3.org/2000/svg" width="24"
                height="18.667" viewBox="0 0 24 18.667">
                <path d="M5.333,0,0,5.32H4v9.347H6.667V5.32h4Zm9.333,18.68V9.333H12V18.68H8L13.333,24l5.333-5.32Z"
                  transform="translate(24) rotate(90)" />
              </svg>
            </div>

            <div class="form__input">
              <label class="form__label">Prihod v</label>
              <mat-form-field class="form__field">
                <input (keyup)="valueChangeFinishDestination($event)" matInput
                  placeholder="Ljubljana, Maribor, Koper, ..." formControlName="tripToLocation" #tripToLocation
                  [matAutocomplete]="matAutocompleteFinish">
              </mat-form-field>
            </div>

            <mat-autocomplete #matAutocompleteFinish="matAutocomplete"
              (optionSelected)="selectFinishLocationSuggestion($event.option.value)">
              <mat-option *ngFor="let hereMapsLocation of locationFinishSuggestions"
                [value]="hereMapsLocation.Location.Address.Label">{{hereMapsLocation.Location.Address.Label}}
              </mat-option>
            </mat-autocomplete>
          </section>

          <section class="form__row">
            <div class="form__input">
              <mat-checkbox class="example-margin">Ustavljam v krajih na poti do cilja po dogovoru z iskalci prevoza.
              </mat-checkbox>
            </div>
          </section>

          <section class="form__row form__row--2-input-fields">
            <div class="form__input">
              <label class="form__label">Datum in ura odhoda</label>
              <mat-form-field class="form__field">
                <input matInput [matDatepicker]="picker" placeholder="Datum ..." formControlName="tripDateAndTime"
                  #tripDateAndTime>
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker startAt="{{curDate | date:'dd. MM yyyy'}}" weekStartsOn="1" #picker></mat-datepicker>
              </mat-form-field>
            </div>

            <div class="form__input form__input--without-label form__input--space-left form__input--2-inputs">
              <div class="form__icon-wrapper form__icon-wrapper--icon-label">
                <svg class="form__svg-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                  viewBox="0 0 24 24">
                  <path
                    d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z" />
                  <path d="M0 0h24v24H0z" fill="none" />
                  <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z" /></svg>
              </div>
              <app-number-picker class="form__time-input" [min]="0" [max]="23" [step]="1" [precision]="1"
                [inputDisabled]="false" (onChange)="onNumberChanged($event)">
              </app-number-picker>
              <div class="form__time-input-dots">
                <svg class="form__svg-icon" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24"
                  style="enable-background:new 0 0 24 24;" xml:space="preserve">
                  <path
                    d="M12,10c1.1,0,2-0.9,2-2s-0.9-2-2-2s-2,0.9-2,2S10.9,10,12,10z M12,14c-1.1,0-2,0.9-2,2s0.9,2,2,2s2-0.9,2-2S13.1,14,12,14z" />
                </svg>
              </div>
              <app-number-picker class="form__time-input" [min]="0" [max]="55" [step]="5" [precision]="1"
                [inputDisabled]="false" (onChange)="onNumberChanged($event)">
              </app-number-picker>
            </div>
          </section>
        </form>
      </mat-step>

      <!-- STEP 2 -->
      <mat-step [stepControl]="addTripFormStep2">
        <form [formGroup]="addTripFormStep2">
          <ng-template matStepLabel>Podrobnosti</ng-template>

          <section class="form__row form__row--2-input-fields">
            <div class="form__input">
              <label class="form__label">Število prostih mest</label>
              <app-number-picker class="form__time-input" [min]="0" [max]="100" [step]="1" [precision]="1"
                [inputDisabled]="false" (onChange)="onNumberChanged($event)">
              </app-number-picker>
            </div>

            <div class="form__input">
              <label class="form__label">Cena prevoza</label>
              <app-number-picker class="form__time-input" [min]="0" [max]="200" [step]="1" [precision]="1"
                [inputDisabled]="false" (onChange)="onNumberChanged($event)">
              </app-number-picker>
            </div>
          </section>

          <section class="form__row">
            <div class="form__input">
              <mat-checkbox class="example-margin">Zagotavljam udoben prevoz (največ 2 osebi na zadnjih sedežih).
              </mat-checkbox>
            </div>
          </section>

          <section class="form__row">
            <div class="form__input">
              <mat-checkbox class="example-margin">Imam nezgodno zavarovanje za potnike v vozilu.
              </mat-checkbox>
            </div>
          </section>

          <mat-form-field class="form__field">
            <input matInput placeholder="tripCategory" formControlName="tripCategory" #tripCategory>
          </mat-form-field>

          <mat-form-field class="form__field">
            <input matInput placeholder="tripCO2Emissions" formControlName="tripCO2Emissions" #tripCO2Emissions>
          </mat-form-field>

          <mat-form-field class="form__field">
            <input matInput placeholder="tripDistance" formControlName="tripDistance" #tripDistance>
          </mat-form-field>

          <mat-form-field class="form__field">
            <input matInput placeholder="tripDuration" formControlName="tripDuration" #tripDuration>
          </mat-form-field>

          <mat-form-field class="form__field">
            <input matInput placeholder="tripFreeSeats" formControlName="tripFreeSeats" #tripFreeSeats>
          </mat-form-field>

          <mat-form-field class="form__field">
            <input matInput placeholder="tripPrice" formControlName="tripPrice" #tripPrice>
          </mat-form-field>

          <mat-form-field class="form__field">
            <input matInput placeholder="tripLuggageSpace" formControlName="tripLuggageSpace" #tripLuggageSpace>
          </mat-form-field>

          <mat-form-field class="form__field">
            <input matInput placeholder="tripComfortable" formControlName="tripComfortable" #tripComfortable>
          </mat-form-field>

          <mat-form-field class="form__field">
            <input matInput placeholder="tripNewPassengersAcceptance" formControlName="tripNewPassengersAcceptance"
              #tripNewPassengersAcceptance>
          </mat-form-field>
        </form>
      </mat-step>

      <!-- STEP 3 -->
      <mat-step [stepControl]="addTripFormStep3">
        <form [formGroup]="addTripFormStep3">
          <ng-template matStepLabel>Zaključek</ng-template>

          <section class="form__row form__row--2-input-fields">
            <div class="form__input">
              <label class="form__label">Kako boš sprejel potnike na tvojem potovanju?</label>
              <mat-radio-group aria-label="Select an option">
                <mat-radio-button value="1">Vsak nov potnik je avtomatsko dodan k mojemu potovanju.</mat-radio-button>
                <mat-radio-button value="2">Vsakega potnika, kateri se prijavi na moje potovanje, moram sprejeti s
                  klikom na povezavo v e-sporočilu.</mat-radio-button>
              </mat-radio-group>
            </div>
          </section>
        </form>
      </mat-step>
    </mat-horizontal-stepper>
  </mat-dialog-content>

  <div class="here-maps__wrapper">
    <app-preloading-spinner [visibility]="preloadingSpinnerVisibility" [diameter]="preloadingSpinnerDiameter"
      [strokeWidth]="preloadingSpinnerStrokeWidth" [mode]="preloadingSpinnerMode">
      <app-here-maps [hereMapStart]="hereMapStart" [hereMapFinish]="hereMapFinish"></app-here-maps>
    </app-preloading-spinner>
  </div>
</div>

<mat-dialog-actions>
  <button mat-raised-button class="button button--default" (click)="onCloseCancel()">Prekliči</button>
  <button *ngIf="stepper.selectedIndex === 0" mat-raised-button class="button button--primary"
    (click)="stepperGoNextStep()" type="button">
    Podrobnosti
    <svg class="button__icon button__icon--on-right" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
      viewBox="0 0 24 24">
      <path d="M0 0h24v24H0z" fill="none" />
      <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z" /></svg>
  </button>
  <button *ngIf="stepper.selectedIndex === 1" mat-raised-button class="button button--default"
    (click)="stepperGoPreviousStep()" type="button">
    <svg class="button__icon button__icon--on-left" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
      viewBox="0 0 24 24">
      <path d="M0 0h24v24H0z" fill="none" />
      <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" /></svg>
    Potek vožnje
  </button>
  <button *ngIf="stepper.selectedIndex === 1" mat-raised-button class="button button--primary"
    (click)="stepperGoNextStep()" type="button">
    Zaključek
    <svg class="button__icon button__icon--on-right" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
      viewBox="0 0 24 24">
      <path d="M0 0h24v24H0z" fill="none" />
      <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z" /></svg>
  </button>
  <button *ngIf="stepper.selectedIndex === 2" mat-raised-button class="button button--default"
    (click)="stepperGoPreviousStep()" type="button">
    <svg class="button__icon button__icon--on-left" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
      viewBox="0 0 24 24">
      <path d="M0 0h24v24H0z" fill="none" />
      <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" /></svg>
    Podrobnosti
  </button>
  <button *ngIf="stepper.selectedIndex === 2" mat-raised-button class="button button--primary"
    (click)="addTrip(authService.userData.uid, '5cc9a86bd5fd5b3c34b3083e', 'Active', '3r34f45f', tripFromLocation.value, tripToLocation.value, date, true, tripCategory.value, tripCO2Emissions.value, tripDistance.value, tripDuration.value, tripFreeSeats.value, tripPrice.value, tripLuggageSpace.value, tripComfortable.value, tripNewPassengersAcceptance.value)">Shrani</button>
</mat-dialog-actions>